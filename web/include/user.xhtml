<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:body>
        <h:form id="frmUserPage">
            <p:panel id="pnlUserPage" visible="#{hpmanager.showUserPage}">
                <div class="inner">
                    <p:panel visible="#{hpmanager.user_ViewPageDefaultMode}">

                        <ui:repeat value="#{hpmanager.projectList}" var="project">
                            <div class="leftbox">
                                <h3>#{project.shortTitle}</h3>
                                <img src="#{project.avatar}" width="93" height="95" class="left" />
                                <p>From #{project.startDate} to #{project.finishDate}</p>
                                <p>#{project.title}</p>
                                <p class="readmore"><p:commandLink value="Read more" action="#{hpmanager.showProject(project)}" process="@this" update=":frmUserPage:pnlUserPage :frmAdminPage:pnlAdminPage"/></p>
                                <div class="clear"></div>
                            </div>
                            <div class="clear br"></div>
                        </ui:repeat>
                        <div class="clear"></div>
                    </p:panel>
                    <p:panel visible="#{hpmanager.user_ViewProjectMode}">
                        <p:outputLabel value="#{hpmanager.selectedProject.title}" style="font-size:14px;"/>
                        <br/>
                        <h:graphicImage alt="img" url="#{hpmanager.selectedProject.avatar}"/>
                        <br/>
                        <p:outputLabel value="Ngày bắt đầu dự án #{hpmanager.selectedProject.startDate} - ngày kết thúc dự án #{hpmanager.selectedProject.finishDate}"/>
                        <br/>Khách hàng: <p:outputLabel value="#{hpmanager.selectedProject.customer}"/>
                        <br/><br/>
                        <ui:repeat value="#{hpmanager.selectedProject.postPartList}" var="postPart">
                            <h:panelGroup rendered="#{postPart.isNewLine == true}">
                                <p></p>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{postPart.isImage == false}">
                                <h:outputLabel value="#{postPart.content}"/>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{postPart.isImage == true}">
                                <h:graphicImage alt="img" url="#{postPart.content}" style="max-width: 80%;"/>
                            </h:panelGroup>
                        </ui:repeat>
                    </p:panel>
                    <p:panel id="pnlUser_SendRequest" visible="#{hpmanager.user_ViewSendRequestMode}">
                        <table>
                            <tr>
                                <td>Elevator system height (floors)</td>
                                <td>
                                    <p:inputText id="txt_sendrequest_floorCount" value="#{hpmanager.sendrequest_Elevator.floorCount}" maxlength="4" required="true" requiredMessage="You must let us know how many floor do you want"  immediate="true">
                                        <p:ajax update="pnlSendRequest_ElevatorInfo"/>
                                    </p:inputText>
                                </td>
                            </tr>
                            <tr>
                                <td>Elevator type</td>
                                <td>
                                    <p:selectOneMenu style="width: 100%;" id="cbbElevatorType" styleClass="cbbMenu" value="#{hpmanager.sendrequest_ElevatorChosed.id}" valueChangeListener="#{hpmanager.elevatorTypeChangeListener}" required="true" requiredMessage="You must select at least one elevator type">
                                        <f:selectItem itemLabel="Select elevator" itemValue="0"/>
                                        <f:selectItems value="#{hpmanager.elevators}" var="elevator" itemLabel="#{elevator.name}" itemValue="#{elevator.id}"/>
                                        <p:ajax event="change" update="pnlSendRequest_ElevatorInfo"/>
                                    </p:selectOneMenu>&nbps;

                                </td>
                            </tr>
                            <tr>
                                <td>Number of systems</td>
                                <td>
                                    <p:inputText id="txt_sendrequest_systemCount" value="#{hpmanager.sendrequest_Elevator.systemCount}" maxlength="3" immediate="true">
                                        <p:ajax update="pnlSendRequest_ElevatorInfo"/>
                                    </p:inputText>
                                </td>
                            </tr>
                            <tr>
                                <td>Installation address (include address name)</td>
                                <td>
                                    <p:inputText id="txt_sendrequest_address" value="#{hpmanager.sendrequest_Elevator.address}" maxlength="3000" required="true" requiredMessage="You must enter address of installation place"/>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <br/><p:commandButton value="Send request" 
                                                          actionListener="#{hpmanager.sendRequest}"
                                                          process="@this txt_sendrequest_address" 
                                                          update="pnlUser_SendRequest lb_sendrequest_mesage"/>
                                    <br/><font color="red"><p:outputLabel id="lb_sendrequest_mesage" value="#{hpmanager.sendrequest_message}"/></font>
                                </td>
                            </tr>
                        </table>
                        <br/>
                        <br/>
                        <p:panel id="pnlSendRequest_ElevatorInfo">
                            Request information
                            <table>
                                <tr>
                                    <td>Total price:</td>
                                    <td>
                                        <p:outputLabel id="txt_sendrequest_totalPrice" value="#{hpmanager.sendrequest_Elevator.totalPrice}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td valign="top">Description:</td>
                                    <td>
                                        <p:outputLabel id="txt_sendrequest_chosedEDescription" value="#{hpmanager.sendrequest_ElevatorChosed.description}"/>
                                    </td>
                                </tr>
                            </table>
                        </p:panel>
                        <p:panel style="overflow: scroll; width: 100%;">
                            <p:dataTable value="#{hpmanager.elevators}" var="ele" styleClass="DataTable"
                                         filteredValue="#{hpmanager.elevatorsFilter}">
                                <p:ajax global="false" process="@this" event="rowToggle"/>
                                <p:column style="width:3%">
                                    <p:commandLink value="Select" process="@this" actionListener="#{hpmanager.selectElevator(ele.id)}" update=":frmUserPage:cbbElevatorType :frmUserPage:pnlSendRequest_ElevatorInfo"/>
                                    <p:rowToggler  />
                                </p:column>
                                <p:column headerText="Name" filterMatchMode="contains" filterBy="#{ele.name}" sortBy="#{ele.name}" >
                                    <h:outputText value="#{ele.name}"/>
                                </p:column>
                                <p:column headerText="Producer" filterMatchMode="contains" filterBy="#{ele.producer}" sortBy="#{ele.producer}" >
                                    <h:outputText value="#{ele.producer}"/>
                                </p:column>
                                <p:column headerText="Made in" filterMatchMode="contains" filterBy="#{ele.country}" sortBy="#{ele.country}" >
                                    <h:outputText value="#{ele.country}"/>
                                </p:column>
                                <p:column headerText="Max human carry" resizable="true" filterMatchMode="contains" filterBy="#{ele.maxHuman}" sortBy="#{ele.maxHuman}" >
                                    <h:outputText value="#{ele.maxHuman}"/>
                                </p:column>
                                <p:column headerText="Floor price" resizable="true" filterMatchMode="contains" filterBy="#{ele.floorPrice}" sortBy="#{ele.floorPrice}" >
                                    <h:outputText value="#{ele.floorPrice}"/>
                                </p:column>
                                <p:rowExpansion>
                                    <p:panelGrid columns="2" styleClass="row-expansion">
                                        <h:outputText value="Product name:"/>
                                        <h:outputText value="#{ele.name}"/>
                                        <h:outputText value="Producer:"/>
                                        <h:outputText value="#{ele.producer}"/>
                                        <h:outputText value="Base price"/>
                                        <h:outputText value="#{ele.basePrice}"/>
                                        <h:outputText value="Floor price"  />
                                        <h:outputText value="#{ele.floorPrice}"/>
                                        <h:outputText value="Max weight" />
                                        <h:outputText value="#{ele.maxWeight}"/>
                                        <h:outputText value="Max human carry" />
                                        <h:outputText value="#{ele.maxHuman}"/>
                                        <h:outputText value="Made in" />
                                        <h:outputText value="#{ele.country}"/>
                                        <h:outputText value="Description" />
                                        <h:outputText value="#{ele.description}"/>
                                    </p:panelGrid>
                                </p:rowExpansion>
                            </p:dataTable>
                        </p:panel>
                    </p:panel>
                    <p:panel id="pnlUser_ViewMyRequests" visible="#{hpmanager.user_ViewRequestMode}">
                        <p:panel id="pnlUser_shSltedReq" visible="#{hpmanager.viewrequest_showSelectedRequest}">
                            <h1><h:outputText value="Selected request"/><br/></h1>
                            <br/>
                            <c:set var="vr" value="#{hpmanager.viewrequest_selectedRequest}"/>
                            <c:set var="vra" value="#{hpmanager.viewrequest_selectedRequestSender}"/>
                            <table>
                                <tr>
                                    <td>
                                        <h:outputText value="From #{vr.postDate} - "/>
                                    </td>
                                    <td>
                                        <h:outputText value="Not started" rendered="#{!vr.processing}"/>
                                        <h:outputText value="#{vr.finishDate}" rendered="#{vr.done}"/>
                                        <h:outputText value="Not finish (#{vr.completedPercent} %)" rendered="#{!vr.done and vr.processing}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Request id</td>
                                    <td>
                                        <h:outputText value="#{vr.id}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Floor count</td>
                                    <td>
                                        <h:outputText value="#{vr.floorCount}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>System count</td>
                                    <td>
                                        <h:outputText value="#{vr.systemCount}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Address</td>
                                    <td>
                                        <h:outputText value="#{vr.address}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total price</td>
                                    <td>
                                        <h:outputText value="#{vr.totalPrice}"/>
                                    </td>
                                </tr>
                            </table>
                            <br/>
                            <p:dataTable id="tblTask" styleClass="DataTable"
                                         value="#{vr.taskList}" var="task" emptyMessage="No task was added for this request">
                                <p:column headerText="Is done">
                                    <p:selectBooleanCheckbox disabled="true" value="#{task.done}"/>
                                </p:column>
                                <p:column headerText="Task">
                                    <p:outputLabel value="#{task.toDo}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <font color="=red"><p:outputLabel id="lbviewrequest_message" value="#{hpmanager.viewrequest_message}"/></font>
                        <h1>All requests</h1>
                        <br/>
                        <p:panel style="width:100%; overflow: scroll">
                            <p:dataTable id="tblMyRequests" styleClass="DataTable" value="#{hpmanager.viewrequest_requestList}" var="vrs" emptyMessage="You didn't send any request to us!"
                                         filteredValue="#{hpmanager.viewrequest_filterRequest}">
                                <p:column headerText="View request">
                                    <center><p:commandLink value="Click" process="@this"
                                                           update=":frmUserPage:pnlUser_shSltedReq"
                                                           actionListener="#{hpmanager.viewRequest(vrs)}"/></center>
                                </p:column>
                                <p:column headerText="Finished date" filterMatchMode="contains" filterBy="#{vrs.completedPercent}" sortBy="#{vrs.completedPercent}">
                                    <center>
                                        <h:outputText value="Not started" rendered="#{!vrs.processing}"/>
                                        <h:outputText value="#{vrs.finishDate}" rendered="#{vrs.done}"/>
                                        <h:outputText value="Not finish (#{vrs.completedPercent}%)" rendered="#{!vrs.done and vrs.processing}"/>
                                    </center>
                                </p:column>
                                <p:column headerText="Elevator" filterMatchMode="contains" filterBy="#{vrs.elevatorName}" sortBy="#{vrs.elevatorName}">
                                    <center><h:outputText value="#{vrs.elevatorName}"/></center>
                                </p:column>
                                <p:column headerText="Price" filterMatchMode="contains" sortBy="#{vrs.totalPrice}">
                                    <center><h:outputText value="#{vrs.totalPrice}"/></center>
                                </p:column>
                                <p:column headerText="id" filterMatchMode="contains" filterBy="#{vrs.id}" sortBy="#{vrs.id}">
                                    <center><h:outputText value="#{vrs.id}"/></center>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:panel>
                    <p:panel id="pnlUser_SendFeedback" visible="#{hpmanager.user_ViewSendFeedbackMode}">
                        <table>
                            <tr>
                                <td>Tên của bạn</td>
                                <td>
                                    <p:inputText id="txt_sendfeedback_senderName" value="#{hpmanager.mfbFeedback.senderName}" required="true"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Email</td>
                                <td>
                                    <p:inputText id="txt_sendfeedback_senderEmail" value="#{hpmanager.mfbFeedback.senderEmail}" required="true"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Mô tả sơ qua</td>
                                <td>
                                    <p:inputText id="txt_sendfeedback_description" value="#{hpmanager.mfbFeedback.description}" required="true"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Đánh giá mức độ</td>
                                <td>
                                    <p:selectOneMenu id="cbb_sendfeedback_rate" value="#{hpmanager.mfbFeedback.rate}" style="width:100%;" >
                                        <f:selectItem itemLabel="Normal" itemValue="1"/>
                                        <f:selectItem itemLabel="Good" itemValue="2"/>
                                        <f:selectItem itemLabel="Pass" itemValue="3"/>
                                        <f:selectItem itemLabel="Bad" itemValue="4"/>
                                    </p:selectOneMenu>
                                </td>
                            </tr>
                            <tr>
                                <td>Vấn đề gặp phải (nếu có)</td>
                                <td>
                                    <p:inputText id="txt_sendfeedback_problem" value="#{hpmanager.mfbFeedback.problem}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Nội dung cần cải thiện (góp ý)</td>
                                <td>
                                    <p:inputText id="txt_sendfeedback_comment" value="#{hpmanager.mfbFeedback.comment}" required="true"/>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <p:commandButton value="Send" action="#{hpmanager.sendfeedback_submit()}"
                                                     process="@this txt_sendfeedback_senderName txt_sendfeedback_senderEmail txt_sendfeedback_description cbb_sendfeedback_rate txt_sendfeedback_problem txt_sendfeedback_comment"
                                                     update="pnlUser_SendFeedback lb_sendfeedback_mesage"/>
                                    <br/><font color="red"><p:outputLabel id="lb_sendfeedback_mesage" value="#{hpmanager.sendfeedback_message}"/></font>
                                </td>
                            </tr>
                        </table>
                    </p:panel>
                </div>
                <!-- end .inner -->
            </p:panel>
        </h:form>
    </h:body>
</html>

